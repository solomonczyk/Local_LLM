# üß† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –ø–∞–º—è—Ç–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–∞

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **PostgreSQL —Å–µ—Ä–≤–µ—Ä** (–≤–µ—Ä—Å–∏—è 12+)
2. **Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `pip install psycopg2-binary`
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –∞–≥–µ–Ω—Ç–∞

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

#### Windows:
```bash
# –°–∫–∞—á–∞—Ç—å —Å https://www.postgresql.org/download/windows/
# –ò–ª–∏ —á–µ—Ä–µ–∑ Chocolatey:
choco install postgresql
```

#### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):
```bash
docker run --name agent-postgres -e POSTGRES_PASSWORD=agent123 -p 5432:5432 -d postgres:14
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL –∫–∞–∫ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
CREATE DATABASE agent_memory;
CREATE USER agent_user WITH PASSWORD 'agent_password';
GRANT ALL PRIVILEGES ON DATABASE agent_memory TO agent_user;
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –∞–≥–µ–Ω—Ç–µ

#### –ß–µ—Ä–µ–∑ UI (http://localhost:7864):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–¥–∫–ª—é—á–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö agent_memory –Ω–∞ localhost —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º agent_user

–ê–≥–µ–Ω—Ç: [–ü–æ–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ]
```

#### –ß–µ—Ä–µ–∑ API:
```bash
curl -X POST http://localhost:8001/tools/db_add_connection \
  -H "Content-Type: application/json" \
  -d '{
    "name": "agent_memory",
    "host": "localhost",
    "database": "agent_memory", 
    "user": "agent_user",
    "password": "agent_password",
    "port": 5432
  }'
```

### 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã –ø–∞–º—è—Ç–∏
```bash
curl -X POST http://localhost:8001/tools/memory_init \
  -H "Content-Type: application/json" \
  -d '{"connection_name": "agent_memory"}'
```

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –ø–∞–º—è—Ç–∏

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã:

### `agent_sessions` - –°–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
- `session_id` - ID —Å–µ—Å—Å–∏–∏
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
- `created_at` - –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- `last_activity` - –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- `message_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- `metadata` - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON)

### `agent_messages` - –°–æ–æ–±—â–µ–Ω–∏—è
- `id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–æ–±—â–µ–Ω–∏—è
- `session_id` - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Å—Å–∏—é
- `role` - –†–æ–ª—å (user, assistant, system, tool)
- `content` - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `timestamp` - –í—Ä–µ–º—è —Å–æ–æ–±—â–µ–Ω–∏—è
- `metadata` - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (JSON)

### `agent_project_context` - –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤
- `session_id` - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Å—Å–∏—é
- `project_name` - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `working_directory` - –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
- `active_files` - –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã (JSON)
- `project_metadata` - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (JSON)

### `agent_knowledge` - –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
- `session_id` - –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Å—Å–∏—é
- `knowledge_type` - –¢–∏–ø –∑–Ω–∞–Ω–∏—è (fact, preference, skill)
- `key_name` - –ö–ª—é—á –∑–Ω–∞–Ω–∏—è
- `value_data` - –î–∞–Ω–Ω—ã–µ (JSON)
- `confidence` - –£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
- `source` - –ò—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞–Ω–∏—è
- `expires_at` - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è

## üîç –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ PostgreSQL –ø–∞–º—è—Ç–∏

### 1. **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫**
```sql
-- –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏–π
SELECT * FROM agent_messages 
WHERE to_tsvector('russian', content) @@ plainto_tsquery('russian', 'PostgreSQL');
```

### 2. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤**
```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–µ—Å—Å–∏—è–º
SELECT 
    COUNT(*) as total_sessions,
    AVG(message_count) as avg_messages,
    MAX(last_activity) as last_activity
FROM agent_sessions;
```

### 3. **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π**
```sql
-- –ó–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT knowledge_type, key_name, value_data 
FROM agent_knowledge 
WHERE session_id = 'user_session_123';
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ PostgreSQL –ø–∞–º—è—Ç–∏

### ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
- –ú–∏–ª–ª–∏–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

### ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –±—ç–∫–∞–ø—ã
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤

### ‚úÖ **–ú–æ—â–Ω—ã–π –ø–æ–∏—Å–∫**
- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ü–æ–∏—Å–∫ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º (JSON)
- –°–ª–æ–∂–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã

### ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
- –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è
- –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "No connection found"
**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —á–µ—Ä–µ–∑ API –∏–ª–∏ UI

### –ü—Ä–æ–±–ª–µ–º–∞: "psycopg2 not installed"
**–†–µ—à–µ–Ω–∏–µ:** `pip install psycopg2-binary`

### –ü—Ä–æ–±–ª–µ–º–∞: "Connection refused"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ PostgreSQL

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç:

- üß† **–î–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–º—è—Ç—å** - –ø–æ–º–Ω–∏—Ç –≤—Å–µ –¥–∏–∞–ª–æ–≥–∏
- üîç **–£–º–Ω—ã–π –ø–æ–∏—Å–∫** - –Ω–∞—Ö–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏—Å—Ç–æ—Ä–∏–∏  
- üìä **–ë–∞–∑—É –∑–Ω–∞–Ω–∏–π** - –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç —Ñ–∞–∫—Ç—ã –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- üìà **–ê–Ω–∞–ª–∏—Ç–∏–∫—É** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- üîÑ **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤** - –ø–æ–º–Ω–∏—Ç —Ä–∞–±–æ—á–∏–µ —Ñ–∞–π–ª—ã

**–ê–≥–µ–Ω—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É —É–º–Ω—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º —Å –ø–∞–º—è—Ç—å—é!** üéâ