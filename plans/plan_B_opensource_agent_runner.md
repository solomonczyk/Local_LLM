# План B — Open-source агент-раннер (локальный Copilot + автономность)

Цель: локальный агент, который может:
- читать/писать файлы проекта
- работать с git
- запускать команды (pytest/npm/go test)
- а Continue использовать как UI/чат в VS Code (по желанию)

---

## Этап 0. Выбор раннера (1 из)
Варианты (локально):
- Aider (сильный на git-патчах)
- OpenHands (более “автономный”)
- Continue CLI (ближе к Continue, но через терминал)

Результат: выбран один раннер под твой стиль.

---

## Этап 1. Стандартизация локального LLM endpoint
1. Привести твой сервер к OpenAI-compatible:
   - `/v1/chat/completions`
   - (желательно) `/v1/models`
2. Поддержать:
   - system/user/assistant messages
   - max_tokens, temperature
   - streaming (опционально)

Результат: раннер и Continue могут использовать один endpoint.

---

## Этап 2. Безопасность tool-доступа (обязательный слой)
1. Определить sandbox-root:
   - доступ только к папке проекта (например `F:\Dev\Projects\LLM_local` или монорепо)
2. Allowlist команд:
   - python -m pytest
   - ruff/black/mypy
   - npm test / npm run lint
   - git status/diff/checkout
3. Denylist:
   - удаление вне проекта
   - доступ к `%USERPROFILE%` и системным каталогам
   - сетевые утилиты (curl/wget) без явного разрешения

Результат: агент не “разносит” систему.

---

## Этап 3. Подключение раннера к локальной модели
1. Настроить API base: `http://localhost:8000/v1`
2. Задать “модель” строкой ID: `qwen2.5-coder-lora`
3. Прогнать smoke-test:
   - “сгенерируй функцию + тесты”
   - “сделай патч коммитом”

Результат: раннер пишет код и правит проект.

---

## Этап 4. Интеграция с VS Code
Варианты:
- Continue как чат/редактор + раннер как автономный терминальный агент
- или полностью раннер внутри терминала, VS Code только как редактор

Результат: единый рабочий процесс.

---

## Этап 5. Мультиагентный “консилиум” в варианте B
1. Реализовать через сценарий:
   - Architect → Security → QA → Dev
2. Механика:
   - каждый агент пишет “решение + риски”
   - Director агрегирует итог (голосование/скоринг)
3. Запуск консилиума:
   - перед началом фичи
   - после больших правок

Результат: меньше тупиков и регрессий.

---

## Этап 6. CI-совместимость
1. Агент умеет запускать те же команды, что CI.
2. “Definition of Done”:
   - tests pass
   - lint pass
   - no secrets
   - docs updated

Результат: агент не ломает pipeline.

---

## Ограничения варианта B
- Зависишь от поведения выбранного open-source раннера.
- Иногда сложнее на Windows (пути/терминал/права).
- Тонкая настройка инструментов может потребовать времени.

---

## Критерий успеха
- Ты даёшь задачу → агент предлагает план → делает патчи → запускает тесты → делает коммит.
- Всё локально, без облака.
